---
title: "Greenhouse Gas Emissions 2018"
author: "Gabriel Berlin"
date: "11/29/2019"
output: html_notebook
---

## load libraries
```{r}
# clear environment
rm(list = ls()) 

# load pakcages
library(DataComputing)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(mosaic)
library(mosaicData)
library(readr)
```

## load data
```{r}
fullEmissionsTable <- read_csv("/home/gabriel/college/Greenhouse Gas Emissions 2018/direct_emitters.csv", skip = 3)
```

## view data
```{r}
names(fullEmissionsTable)
str(fullEmissionsTable)
head(fullEmissionsTable, 10)
```

The table's columns contain information about three different things: information about the facility, actual emissions data, and how gasses were emitted.
How gasses were emitted is not relevant to the research question, so I will focus on only the first two categories and I will get rid of the variables I do not need..

# data wrangling
```{r}
emissionsTable <- 
  fullEmissionsTable %>%
  rename(sector = `Industry Type (sectors)`) %>%
  select(`Facility Id`, `FRS Id`, `Facility Name`, `State`, Latitude, Longitude, 
         `sector`, `Total reported direct emissions`, 
         `CO2 emissions (non-biogenic)`, `Methane (CH4) emissions`, 
         `Nitrous Oxide (N2O) emissions`, `HFC emissions`, `PFC emissions`, `SF6 emissions`,
         `NF3 emissions`, `Other Fully Fluorinated GHG emissions`, `HFE emissions`,
         `Other GHGs (metric tons CO2e)`, `Biogenic CO2 emissions (metric tons)`)
```

View a table of all the different sectors and how many times they appear in the emissions table.
# create list of sectors/industries
```{r}
emissionsTable %>%
  group_by(sector) %>%
  summarise(total = n())
```

There are multiple sectors in some of the values. For example, "Chemicals,Coal-based Liquid Fuel Supply,Suppliers of CO2". Because there are multiple values in a single cell, this data is not in tidy form. To make it in tidy form I will make sure there is only one value in a cell. Additionally, many details are not necessary.
I will need to use regular expressions and a loop to replace the values.

### pseudo-code: first create a regular expression, then use the loop
```{r}
chem <- "Chemicals"
metals <- "Metals"
minerals <- "Minerals"
natural <- "Natural Gas"
other <- "Other"
petro <- "Petroleum"
paper <- "Pulp"
injection <- "Injection"
```


```{r}
emissionsTable %>%
  mutate(sector = gsub(pattern = "^Chemic+", replacement = chem, sector),
         )

```

```{r}
#Original Code: (will change)
for (i in 1:length(emissionsTable$sector)) {
  if (grep(emissionsTable$sector[i] == "Chemical")) {
    mutate(sector = chem)
  } }
```
  else if (sectorList[i] == "$Metals") {
    mutate(sector = metals)
  } else if (sectorList[i] == "$Minerals") {
    mutate(sectorList, sector = minerals)
  } else if (sectorList[i] == "$Natural") {
    mutate(sectorList, sector = natural)
  } else if (sectorList[i] == "$Petroleum") {
    mutate(sectorList, sector = petro)
  } else if (sectorList[i] == "$Pulp") {
    mutate(sectorList, sector = paper)
  } else if (sectorList[i] == "$Injection") {
    mutate(sectorList, sector = injection)
  } else {
    mutate(sectorList, sector = other)
  }
}


# View all emissions by sector
```{r}
emissionsTable %>%
  group_by(sector) %>%
  summarise(emissions = sum(`Total reported direct emissions`)) %>%
  arrange(desc(emissions))
```

# View CO2 and methane emissions 
```{r}
emissionsTable %>%
  group_by(sector) %>%
  summarise("CO2 Emissions" = sum(`CO2 emissions (non-biogenic)`, na.rm = TRUE),
            "Methand Emissions" = sum(`Methane (CH4) emissions`, na.rm = TRUE))


```

# Total emissions by state
```{r}
emissionsTable %>%
  group_by(State) %>%
  summarise(emissions = sum(`Total reported direct emissions`))
```

Would be better to get emissions on a per capita basis by state. Each of these states have huge differences in population size


Will be interesting to see a map with emissions superimposed
```{r}
library(maps)
```

```{r}
data("usaMapEnv")
```
