---
title: "Greenhouse Gas Emissions 2018"
author: "Gabriel Berlin"
date: "11/29/2019"
output: html_notebook
---

# Greenhouse Gas Emissions in 2018 across the United States
## Greenhouse gas reporting program fun by the epa requires all facilities that emit over 25,000 metric tons of CO2 to record and report their emissions. The EPA makes these data publicly available.
## In this project I will look at greenhouse gas emissions across industries and states. Knowing the source of emissions and the purpose of those emissions will help people better reduce those emissions. 

## First I need to load packages and data
### load libraries
```{r}
# clear environment
rm(list = ls()) 

# load pakcages
library(DataComputing)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(mosaic)
library(mosaicData)
library(readr)
library(maps)
library(rvest)
```

# load data
```{r}
fullEmissionsTable <- read_csv("/home/gabriel/college/Greenhouse Gas Emissions 2018/direct_emitters.csv", skip = 3)
populationWebPage <- "https://en.m.wikipedia.org/wiki/List_of_states_and_territories_of_the_United_States_by_population"
populationByStateTables <-
  populationWebPage %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)
```

### I need to get the first table
```{r}
populationByState <- populationByStateTables[[1]]
```

# view data
## Names of the columns
```{r}
names(fullEmissionsTable)
```

## Information about the table
```{r}
str(fullEmissionsTable)
```

## First few rows of the table
```{r}
head(fullEmissionsTable, 10)
```

# The table's columns contain information about three different things: information about the facility, actual emissions data, and how gasses were emitted. How gasses were emitted is beyond the scopeof  the research question, so I will focus on only the first two categories and I will get rid of the variables I do not need. 

## data wrangling
```{r}
emissionsTable <- 
  fullEmissionsTable %>%
  rename(sector = `Industry Type (sectors)`) %>%
  select(`Facility Id`, `FRS Id`, `Facility Name`, `State`, Latitude, Longitude, 
         `sector`, `Total reported direct emissions`, 
         `CO2 emissions (non-biogenic)`, `Methane (CH4) emissions`, 
         `Nitrous Oxide (N2O) emissions`, `HFC emissions`, `PFC emissions`, `SF6 emissions`,
         `NF3 emissions`, `Other Fully Fluorinated GHG emissions`, `HFE emissions`,
         `Other GHGs (metric tons CO2e)`, `Biogenic CO2 emissions (metric tons)`)
```


# View a table of all the different sectors and how many times they appear in the emissions table.
## View list of sectors/industries
```{r}
fullEmissionsTable %>%
  group_by(`Industry Type (sectors)`) %>%
  summarise(total = n()) %>%
  arrange(desc(total))

emissionsTable %>%
  group_by(sector) %>%
  summarise(total = n())
```

## There are multiple sectors in some of the values. For example, "Chemicals,Coal-based Liquid Fuel Supply,Suppliers of CO2". Because there are multiple values in a single cell, this data is not in tidy form. To make it in tidy form I will make sure there is only one value in a cell. Additionally, these details are not relevant. I will need to use regular expressions and a loop to replace the values.

## these are the new simplified sectors
```{r}
chem <- "Chemicals"
metals <- "Metals"
minerals <- "Minerals"
natural <- "Natural Gas"
other <- "Other"
petro <- "Petroleum"
paper <- "Pulp"
power <- "Power Plants"
injection <- "Injection"
```


## loop through the emissions table and replace the sector values with their simplified version
```{r}
s <- "" # variable needed to loop through table
i <- 0

for (i in 1:nrow(emissionsTable)) {
  s <- emissionsTable[i, "sector"]  # access sector value in each row
  if (grepl(pattern = "^Chemical", s)) {
    emissionsTable[i, "sector"] = chem
  }  else if (grepl(pattern = "^Metals", s)) {
    emissionsTable[i, "sector"] = metals
  } else if (grepl(pattern = "^Minerals", s)) {
    emissionsTable[i, "sector"] = minerals
  } else if (grepl(pattern = "^Natural", s)) {
    emissionsTable[i, "sector"] = natural
  } else if (grepl(pattern = "^Petroleum", s)) {
    emissionsTable[i, "sector"] = petro
  } else if (grepl(pattern = "^Pulp", s)) {
    emissionsTable[i, "sector"] = paper
  } else if (grepl(pattern = "^Injection", s)) {
   emissionsTable[i, "sector"] = injection
  } else if (grepl(pattern = "^Power Plant", s)) {
    emissionsTable[i, "sector"] = power
  } else {
    emissionsTable[i, "sector"] = other
  }
}
```

# View all emissions by sector
```{r}
emissionsTable %>%
  group_by(sector) %>%
  summarise(emissions = sum(`Total reported direct emissions`)) %>%
  arrange(desc(emissions))
```

# View CO2 and methane emissions 
```{r}
emissionsTable %>%
  group_by(sector) %>%
  summarise("CO2 Emissions" = sum(`CO2 emissions (non-biogenic)`, na.rm = TRUE),
            "Methand Emissions" = sum(`Methane (CH4) emissions`, na.rm = TRUE))


```

# Total emissions by state
```{r}
emissionsTable %>%
  group_by(State) %>%
  summarise(emissions = sum(`Total reported direct emissions`))
```

Would be better to get emissions on a per capita basis by state. Each of these states have huge differences in population size
# get table with states and population
# add total emissions to that table
# divide emissions per state by populaiton of that state

Will be interesting to see a map with emissions superimposed
```{r}
data("usaMapEnv")
```






How in depth?
as much level as the weekly projects
look at check sheet
I'm directing the analysis



